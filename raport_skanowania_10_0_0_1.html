
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raport Skanowania Sieci</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h1 { text-align: center; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); background-color: #fff; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #4CAF50; color: white; text-align: center; position: relative; } /* Dodano position: relative */
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f1f1f1; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .legend-section { margin-top: 30px; padding: 15px; background-color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .legend-section h2 { margin-top: 0; color: #4CAF50; }
        .legend-section ul { list-style-type: none; padding-left: 0; }
        .legend-section li { margin-bottom: 5px; }
        .device-row td { vertical-align: top; }
        
        /* Style dla sortowania */
        th.sortable-header { cursor: pointer; }
        th.sortable-header:hover { background-color: #3e8e41; }
        .sort-indicator {
            display: inline-block; /* Zmieniono na inline-block dla lepszego pozycjonowania */
            margin-left: 5px;
            color: #a0d0a0; /* Jaśniejszy kolor dla nieaktywnych wskaźników */
            font-size: 0.9em;
        }
        .sort-indicator.active {
            color: white; /* Kolor aktywnego wskaźnika */
        }

        /* Style dla modala WoL */
        .wol-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .wol-modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19); border-radius: 5px; text-align: left; }
        .wol-modal-close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .wol-modal-close:hover, .wol-modal-close:focus { color: black; text-decoration: none; cursor: pointer; }
        #wolCommandInput { width: calc(100% - 90px); padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #f9f9f9; }
        .wol-modal-content button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .wol-modal-content button:hover { background-color: #45a049; }
        #copyWolStatus { font-size: 0.9em; color: green; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>Raport Skanowania Sieci</h1>
    <table>
        <thead>
            <tr>
                <th>Lp.</th>

                <th class="sortable-header" data-column-key="ip">
                    Adres IP
                    <span class="sort-indicator">&#x25B2;&#x25BC;</span>
                </th>

                <th class="sortable-header" data-column-key="mac">
                    Adres MAC
                    <span class="sort-indicator">&#x25B2;&#x25BC;</span>
                </th>

                <th class="sortable-header" data-column-key="host">
                    Nazwa Hostu
                    <span class="sort-indicator">&#x25B2;&#x25BC;</span>
                </th>
                <th>Otwarte Porty</th>

                <th class="sortable-header" data-column-key="os">
                    System (Przyp.)
                    <span class="sort-indicator">&#x25B2;&#x25BC;</span>
                </th>

                <th class="sortable-header" data-column-key="oui">
                    Producent (OUI)
                    <span class="sort-indicator">&#x25B2;&#x25BC;</span>
                </th>

            </tr>
        </thead>
        <tbody id="devicesTableBody">
            <tr class='device-row'>
                <td>1</td>
                <td>10.0.0.1</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('00:1B:11:F8:E5:B8')" title="Wyślij pakiet Wake-on-LAN">00:1B:11:F8:E5:B8</a></td>
                <td>Nieznana</td>
                <td><a href="http://10.0.0.1:80" target="_blank" title="Otwórz aplikację webową (Usługa: Serwer webowy http)" >80</a></td>
                <td>NetDev/Web</td>
                <td>D-Link Corporation</td>
            </tr>
            <tr class='device-row'>
                <td>2</td>
                <td>10.0.0.3</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('00:1C:F0:75:72:F1')" title="Wyślij pakiet Wake-on-LAN">00:1C:F0:75:72:F1</a></td>
                <td>Nieznana (Brama)</td>
                <td>21, 22, 23, <a href="http://10.0.0.3:80" target="_blank" title="Otwórz aplikację webową (Usługa: Serwer webowy http)" >80</a></td>
                <td>Lin/Mac (SSH)</td>
                <td>D-Link Corporation</td>
            </tr>
            <tr class='device-row'>
                <td>3</td>
                <td>10.0.0.5</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('F8:CA:B8:19:52:3F')" title="Wyślij pakiet Wake-on-LAN">F8:CA:B8:19:52:3F</a></td>
                <td>EndiAligator (Ty)</td>
                <td>135, 139, 445</td>
                <td>Win (SMB)</td>
                <td>Dell Inc.</td>
            </tr>
            <tr class='device-row'>
                <td>4</td>
                <td>10.0.0.6</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('40:91:51:52:AF:CA')" title="Wyślij pakiet Wake-on-LAN">40:91:51:52:AF:CA</a></td>
                <td>Nieznana</td>
                <td><a href="http://10.0.0.6:80" target="_blank" title="Otwórz aplikację webową (Usługa: Serwer webowy http)" >80</a></td>
                <td>NetDev/Web</td>
                <td>Espressif Inc.</td>
            </tr>
            <tr class='device-row'>
                <td>5</td>
                <td>10.0.0.7</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('00:01:E3:B1:4B:7B')" title="Wyślij pakiet Wake-on-LAN">00:01:E3:B1:4B:7B</a></td>
                <td>SinensTelefinVOIP</td>
                <td><a href="http://10.0.0.7:80" target="_blank" title="Otwórz aplikację webową (Usługa: Serwer webowy http)" >80</a>, 5060</td>
                <td>NetDev/Web</td>
                <td>Siemens AG</td>
            </tr>
            <tr class='device-row'>
                <td>6</td>
                <td>10.0.0.9</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('B8:27:EB:D7:EB:F0')" title="Wyślij pakiet Wake-on-LAN">B8:27:EB:D7:EB:F0</a></td>
                <td>OSMC</td>
                <td>22, <a href="http://10.0.0.9:80" target="_blank" title="Otwórz aplikację webową (Usługa: Serwer webowy http)" >80</a>, 139, 445, 3389, 9090</td>
                <td>Lin/Media (Samba,RDP?)</td>
                <td>Raspberry Pi Foundation</td>
            </tr>
            <tr class='device-row'>
                <td>7</td>
                <td>10.0.0.10</td>
                <td><a href="javascript:void(0);" onclick="showWolCommand('4A:01:FE:E1:2E:19')" title="Wyślij pakiet Wake-on-LAN">4A:01:FE:E1:2E:19</a></td>
                <td>Samsung G S20FE</td>
                <td></td>
                <td>Nieznany (No Ports)</td>
                <td>Nieznany</td>
            </tr>

        </tbody>
    </table>

    <div class="legend-section">
        <h2>Legenda Otwartych Portów</h2>
        <ul>
            <li><b>21:</b> FTP (File Transfer Protocol)</li>
            <li><b>22:</b> SSH (Secure Shell)</li>
            <li><b>23:</b> Telnet</li>
            <li><b>80:</b> Serwer webowy http</li>
            <li><b>135:</b> Microsoft RPC (Remote Procedure Call)</li>
            <li><b>139:</b> NetBIOS Session Service</li>
            <li><b>445:</b> Microsoft-DS (SMB - Server Message Block)</li>
            <li><b>3389:</b> RDP (Remote Desktop Protocol)</li>
            <li><b>5060:</b> SIP (Session Initiation Protocol) - używany do VoIP</li>
            <li><b>9090:</b> Prometheus Server</li>

        </ul>
    </div>

    <div class="legend-section">
        <h2>Legenda Skrótów Systemów/Urządzeń</h2>
        <ul>
            <li><b>Lin/Mac (SSH):</b> System Linux/macOS (wykryto port SSH)</li>
            <li><b>Lin/Media (Samba,RDP?):</b> Linux Media Center (wykryto SSH, Samba(139), potencjalnie RDP)</li>
            <li><b>NetDev/Web:</b> Urządzenie sieciowe, urządzenie IoT lub serwer z interfejsem webowym.</li>
            <li><b>Nieznany (No Ports):</b> Nieznany typ urządzenia (brak otwartych portów)</li>
            <li><b>Win (SMB):</b> System Windows (wykryto porty SMB/NetBIOS/RPC)</li>

        </ul>
    </div>
    
    <div id="wolModal" class="wol-modal">
        <div class="wol-modal-content">
            <span class="wol-modal-close" onclick="closeWolModal()">&times;</span>
            <h2>Wyślij Pakiet Wake-on-LAN</h2>
            <p>Aby wysłać pakiet Wake-on-LAN (WoL) do urządzenia z adresem MAC <strong id="wolMacAddress"></strong>, możesz użyć poniższego polecenia w terminalu, będąc w katalogu, w którym znajduje się skrypt:</p>
            <input type="text" id="wolCommandInput" readonly>
            <button onclick="copyWolCommand()">Kopiuj</button>
            <p id="copyWolStatus"></p>
            <p style="font-size:0.8em; color:#555;">Upewnij się, że urządzenie docelowe oraz jego karta sieciowa są skonfigurowane do odbierania pakietów WoL, a zapory sieciowe nie blokują portu (domyślnie 9 UDP).</p>
        </div>
    </div>

    <script>
        const displayedColumns = ["lp", "ip", "mac", "host", "porty", "os", "oui"];
        let currentSortKey = null;
        let currentSortDirection = 'none'; // 'asc', 'desc', 'none'

        function getCellContentForSort(row, columnKey) {
            const columnIndex = displayedColumns.indexOf(columnKey);
            if (columnIndex === -1 || !row.cells[columnIndex]) {
                return '';
            }
            let cellText = row.cells[columnIndex].textContent || row.cells[columnIndex].innerText || '';
            cellText = cellText.trim();

            if (columnKey === 'host') {
                // Usuwa znaczniki typu (Ty), (Brama), (ARP Only) z końca dla sortowania
                // Dzieli po pierwszym wystąpieniu " (" i bierze pierwszą część
                const parts = cellText.split(" (");
                cellText = parts[0].trim();
            }
            return cellText;
        }

        function compareIpAddresses(ipA, ipB) {
            const partsA = ipA.split('.').map(Number);
            const partsB = ipB.split('.').map(Number);
            for (let i = 0; i < 4; i++) {
                if (isNaN(partsA[i]) && isNaN(partsB[i])) continue;
                if (isNaN(partsA[i])) return 1; // Traktuj NaN jako większe
                if (isNaN(partsB[i])) return -1; // Traktuj NaN jako większe

                if (partsA[i] < partsB[i]) return -1;
                if (partsA[i] > partsB[i]) return 1;
            }
            return 0;
        }

        function compareValues(key, order, rowA, rowB) {
            const valA = getCellContentForSort(rowA, key);
            const valB = getCellContentForSort(rowB, key);

            let comparison = 0;
            if (key === 'ip') {
                comparison = compareIpAddresses(valA, valB);
            } else {
                const specialValues = ["Nieznana", "Błąd", "Nieznany MAC", "Nieznany OS"];
                // Sprawdź, czy wartość ZACZYNA SIĘ od specjalnej wartości (np. "Nieznana (Ty)")
                const isASpecial = specialValues.some(sv => valA.startsWith(sv));
                const isBSpecial = specialValues.some(sv => valB.startsWith(sv));

                if (isASpecial && !isBSpecial) {
                    comparison = 1; 
                } else if (!isASpecial && isBSpecial) {
                    comparison = -1;
                } else {
                    if (valA.toLowerCase() < valB.toLowerCase()) {
                        comparison = -1;
                    }
                    if (valA.toLowerCase() > valB.toLowerCase()) {
                        comparison = 1;
                    }
                }
            }
            return (order === 'desc' ? (comparison * -1) : comparison);
        }

        function updateSortIndicators(clickedThKey, direction) {
            document.querySelectorAll('th.sortable-header .sort-indicator').forEach(span => {
                const th = span.closest('th');
                if (th.dataset.columnKey === clickedThKey) {
                    span.innerHTML = direction === 'asc' ? '&#x25B2;' : (direction === 'desc' ? '&#x25BC;' : '&#x25B2;&#x25BC;');
                    span.classList.add('active');
                } else {
                    span.innerHTML = '&#x25B2;&#x25BC;';
                    span.classList.remove('active');
                }
            });
        }

        function sortTable(columnKey, thElement) {
            if (currentSortKey === columnKey) {
                if (currentSortDirection === 'asc') {
                    currentSortDirection = 'desc';
                } else if (currentSortDirection === 'desc') {
                    // Opcjonalnie: trzecie kliknięcie resetuje sortowanie lub wraca do 'asc'
                    // Tutaj wracamy do 'asc' dla prostoty
                     currentSortDirection = 'asc';
                    // currentSortDirection = 'none'; // Jeśli chcesz resetować
                } else { // Było 'none'
                    currentSortDirection = 'asc';
                }
            } else {
                currentSortKey = columnKey;
                currentSortDirection = 'asc';
            }
            
            // if (currentSortDirection === 'none' && currentSortKey === columnKey) {
            //     // Jeśli chcemy resetować, to tutaj odtwarzamy oryginalną kolejność
            //     // To wymagałoby przechowywania oryginalnych danychlub ponownego renderowania
            //     // Na razie pomijamy pełny reset dla uproszczenia
            //     updateSortIndicators(columnKey, 'none');
            //     // return; // Nie sortuj, jeśli reset
            // }


            updateSortIndicators(columnKey, currentSortDirection);

            const tableBody = document.getElementById('devicesTableBody');
            const rows = Array.from(tableBody.querySelectorAll('tr.device-row'));

            rows.sort((a, b) => compareValues(columnKey, currentSortDirection, a, b));

            // Ponowne numerowanie kolumny Lp.
            const lpCellIndex = displayedColumns.indexOf('lp');
            if (lpCellIndex !== -1) {
                rows.forEach((row, index) => {
                    if (row.cells[lpCellIndex]) {
                        row.cells[lpCellIndex].textContent = index + 1;
                    }
                });
            }
            
            tableBody.innerHTML = ''; // Wyczyść istniejące wiersze
            rows.forEach(row => tableBody.appendChild(row));
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('th.sortable-header').forEach(th => {
                th.addEventListener('click', () => {
                    const columnKey = th.dataset.columnKey;
                    sortTable(columnKey, th);
                });
            });
        });

        // Funkcje dla modala WoL
        const SCRIPT_NAME_WOL = "skaner_sieci.py"; // Zmieniono na placeholder

        const wolModal = document.getElementById('wolModal'); // Get modal element once


        function showWolCommand(macAddress) {{ // ZMIANA: {{ -> {
            const modal = document.getElementById('wolModal');
            const commandInput = document.getElementById('wolCommandInput');
            const macDisplay = document.getElementById('wolMacAddress');
            const copyStatus = document.getElementById('copyWolStatus');

            macDisplay.textContent = macAddress;
            commandInput.value = 'python ' + SCRIPT_NAME_WOL + ' -wol ' + macAddress; // SCRIPT_NAME_WOL jest już wartością
            modal.style.display = 'block';
            copyStatus.textContent = ''; // Wyczyść status kopiowania
        }} // ZMIANA: }} -> }

        function closeWolModal() {{ // ZMIANA: {{ -> {
            const modal = wolModal; // Use the cached element
            modal.style.display = 'none';
        }} // ZMIANA: }} -> }

        function copyWolCommand() {{ // ZMIANA: {{ -> {
            const commandInput = document.getElementById('wolCommandInput');
            commandInput.select(); // Zaznacz tekst w polu
            navigator.clipboard.writeText(commandInput.value).then(() => {{ // ZMIANA: {{ -> {
                const copyStatus = document.getElementById('copyWolStatus'); // Get status element once
                copyStatus.textContent = 'Skopiowano do schowka!';
                // Opcjonalnie: ukryj status po kilku sekundach
                setTimeout(() => {{ // ZMIANA: {{ -> {
                    copyStatus.textContent = '';
                }}, 3000); // Ukryj po 3 sekundach
            }}, (err) => {{ // POPRAWKA: Zmieniono {{{{ na {{
                const copyStatus = document.getElementById('copyWolStatus'); // Get status element once
                copyStatus.textContent = 'Błąd kopiowania!';
                console.error('Błąd kopiowania WoL: ', err);
                // Opcjonalnie: ukryj status błędu po kilku sekundach
            }}); // POPRAWKA: Odpowiadający nawias zamykający (logicznie zmieniony z }}}} na }})
        }} // ZMIANA: }} -> }
    </script>
</body>
</html>
